<div class="container">


  <div class="grid">
    <div class="col-12 md:col-6 lg:col-3">
      <h2> Cadastro Produto</h2>
    </div>
  </div>

  <div class="card">
    <form #f="ngForm" autocomplete="off" (ngSubmit)="salvar(f)">
      <div class="grid nested-grid p-fluid">
        <div class="col-8 md:col-6 lg:col-8 p-fluid">
          <div class="grid">
            <div class="col-12 md:col-6 lg:col-7 p-fluid">


              <span class="p-float-label">
                <input type="text" id="produtonome" required="true" name="nomeproduto" pInputText
                  [(ngModel)]="produto.nomeproduto" ngModel #nomeproduto="ngModel" />

                <label for="produtonome">Nome Produto</label>


              </span>
              <app-message [control]="nomeproduto" error="required" text="Informe  Nome do produto"></app-message>
            </div>
            <div class="col-12 md:col-6 lg:col-1 p-fluid">
              <div class="field-checkbox">
                <p-checkbox inputId="binary" name="ativo" [(ngModel)]="produto.ativo" [binary]="true">
                </p-checkbox>
                <label for="marca">Ativo</label>
              </div>
            </div>
            <div class="col-12 md:col-6 lg:col-2 p-fluid">
              <div class="field-checkbox">
                <p-checkbox inputId="binary" name="controlarestoque" [(ngModel)]="produto.controlarestoque"
                  [binary]="true">
                </p-checkbox>
                <label for="marca">Controlar Estoque ?</label>
              </div>
            </div>


            <div class="col-12 md:col-6 lg:col-2 p-fluid">
              <span class="p-float-label">
                <input type="text" id="unidade" pInputText name="unidade" required="true"
                  [(ngModel)]="produto.unidade" />

                <label for="unidade">Unidade</label>


              </span>
            </div>
            <div class="col-12 md:col-6 lg:col-4 p-fluid">
              <span class="p-float-label">
                <p-inputNumber inputId="custo" currency="BRL" mode="currency" name="precocusto" locale="pt-Br"
                  [(ngModel)]="produto.precocusto" [minFractionDigits]="2"></p-inputNumber>
                <label for="custo"> Preço Custo</label>
              </span>

            </div>
            <div class="col-12 md:col-6 lg:col-4 p-fluid">
              <span class="p-float-label">
                <p-inputNumber inputId="custo_nedio" currency="BRL" [required]="true" #customedio="ngModel"
                  name="customedio" mode="currency" locale="pt-Br" [(ngModel)]="produto.customedio"
                  [minFractionDigits]="2"></p-inputNumber>
                <label for="custo_medio"> Custo Médio</label>
                <div *ngIf="customedio.hasError('required') && customedio.dirty">
                  <small id="inputnumber" class="p-message p-message-error">Campo requirdo.</small>
                </div>
              </span>

            </div>
            <div class="col-12 md:col-6 lg:col-4 p-fluid">
              <span class="p-float-label">
                <p-inputNumber inputId="preco_venda" currency="BRL" mode="currency" name="precovenda" locale="pt-Br"
                  [(ngModel)]="produto.precovenda" [minFractionDigits]="2"></p-inputNumber>
                <label for="preco_venda"> Preço de Venda</label>
              </span>

            </div>
            <div class="col-12 md:col-6 lg:col-5 p-fluid">


              <span class="p-float-label">
                <p-autoComplete [(ngModel)]="produto.subcategoria" appendTo="body" [showEmptyMessage]="true"
                  field="nomeSubCategoria" [suggestions]="subcategorias"
                  (completeMethod)="carregarSubcategorias($event)" name="nomeSubCategoria" id="campo" [required]="true"
                  inputId="autocomplete" [minLength]="1" emptyMessage="Registro não ncontrato"></p-autoComplete>
                <label for="subcategorias ">SubCategorias</label>
              </span>


            </div>
            <div class="col-12 md:col-6 lg:col-1  p-fluid  flex flex-wrap align-items-center justify-content-center ">

              <button pButton pRipple type="button" icon="pi pi-plus"   (click)="showSubcategoria()"  pTooltip="Adicionar subcategoria"
                class=" p-button-lg p-button-info"></button>


            </div>


            <div class="col-12 md:col-6 lg:col-6 p-fluid">

              <span class="p-float-label">
                <input type="text" id="marcaproduto" required="true" pInputText name="marca"
                  [(ngModel)]="produto.marca" />

                <label for="marcaproduto">Marca</label>
              </span>
            </div>

            <div class="col-12 md:col-6 lg:col-5 p-fluid">
              <span class="p-float-label">
                <input type="text" id="marca" pInputText name="codigoEan13" [(ngModel)]="produto.codigoEan13" />

                <label for="marca">Codigo Ean 13</label>
              </span>
            </div>
            <div class="col-12 md:col-6 lg:col-4 p-fluid">
              <span class="p-float-label">
                <input type="text" id="fabricante" pInputText name="codigofabricante"
                  [(ngModel)]="produto.codigofabricante" />

                <label for="fabricante">Código Fabricante</label>
              </span>
            </div>
            <div class="col-12 md:col-6 lg:col-3 p-fluid">


              <span class="p-float-label">
                <p-inputNumber [(ngModel)]="produto.estoqueminimo" name="estoqueminimo" mode="decimal" dec
                  [showButtons]="true" precision="0" inputId="minmax-buttons" [min]="0" [max]="100"
                  [(ngModel)]="produto.estoqueminimo">
                </p-inputNumber>
                <label for="estoqueminimo">Estoque Minimo</label>
              </span>

            </div>

            <div class="col-12 md:col-6 lg:col-4">
              <span class="p-float-label">
                <input type="text" id="sku" pInputText name="sku" [(ngModel)]="produto.sku" />

                <label for="sku">Sku</label>
              </span>
            </div>
            <div class="col-12 md:col-6 lg:col-6 p-fluid">
              <span class="p-float-label">
                <input type="text" id="caracteristica" pInputText name="caracteristica"
                  [(ngModel)]="produto.caracteristica" />

                <label for="caracteristica">Caracteristicas</label>
              </span>
            </div>

            <div class="col-12 md:col-6 lg:col-2 p-fluid">

              <button pButton pRipple type="button" icon="pi pi-check" (click)="abrirdialog()" label="Variações"
                pTooltip="Adicionar Variacões" class=" p-button-lg p-button-secondary"></button>
            </div>

          </div>

        </div>
        <div class="col-4 md:col-6 lg:col-4 p-fluid">

          <div class="h-full  picture">

            <span class="picture__image"> <img [src]="url"></span>



          </div>



        </div>
        <div class="col-12 md:col-6 lg:col-8 p-fluid">
          <span class="p-float-label">
            <input type="text" id="descricao" pInputText name="descricao" [(ngModel)]="produto.descricao" />

            <label for="descricao">Descrição</label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <button pButton type="button" icon=" pi pi-images" class=" p-button-lg p-button-info" label="Imagem"
            pTooltip="Adicionar Imagem" (click)="upLoad()"></button>
        </div>

        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <button pButton pRipple type="button" class="p-button-lg p-button-danger" icon="pi pi-minus"
            label="Remover"></button>


        </div>



        <div class="col-6 md:col-6 lg:col-2 p-fluid">

          <button pButton pRipple type="button" icon="pi pi-sign-in" label="Voltar" routerLink="/produtos"
            class="p-button-outlined p-button-lg p-button-danger"></button>
        </div>
        <div class="col-6 md:col-6 lg:col-2 p-fluid">
          <button pButton pRipple type="submit" [disabled]="!f.valid" class="p-button-lg p-button-success"
            icon="pi pi-save" label="Salvar"></button>


        </div>
      </div>

    </form>
  </div>
  <p-dialog header="Atributos" [(visible)]="exibirFormAtributos" [breakpoints]="{'960px': '70vw'}"
    [style]="{width: '55vw'}" [responsive]="true" [modal]="true" [draggable]="false" [resizable]="false"
    styleClass="p-fluid">



    <ng-template pTemplate="content">

      <p></p>
      <div class="grid p-fluid p-formgroup-inline">

        <div class=" col-12 md:col-6  lg:col-6 p-fluid ">
          <span class="p-float-label">
            <input type="text" id="inptproduto" pInputText required="true" pInputText name="tipo"
              [(ngModel)]="atributo.tipo" />

            <label for="inptproduto">Tipo</label>


          </span>
        </div>


        <div class="col-12 md:col-6 lg:col-5 p-fluid">
          <span class="p-float-label">
            <input type="text" id="marca" pInputText name="valor" [(ngModel)]="atributo.valor" />

            <label for="marca">Valor</label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-1">

          <button pButton pRipple icon="pi pi-plus" type="button" (click)="addAtributo()" pTooltip="Adicionar atributos"
            class="p-button-success p-button-lg"></button>

        </div>

        <div class=" grid">
          <div class="col-12">
            <p-table [value]="produto.atributos" [responsive]="true" selectionMode="single">
              <ng-template pTemplate="header">
                <tr>
                  <th style="width: 500px">Tipo</th>
                  <th style="width: 500px">Valor</th>

                  <th> Opção</th>

                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-atributo let-rowIndex="rowIndex">
                <tr [pSelectableRow]="atributo">
                  <td>{{atributo.tipo}}</td>
                  <td>{{atributo.valor}}</td>
                  <td>
                    <button pButton (click)="remover(rowIndex)" icon="pi pi-minus" pTooltip="Excluir"
                      class=" p-button-danger -button-sm -button-sm"></button>

                  </td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </div>

      </div>

    </ng-template>

    <ng-template pTemplate="footer">
      <p-button (click)="exibirFormAtributos=false" label="sair" styleClass="p-button-text"></p-button>

    </ng-template>

  </p-dialog>
</div>
