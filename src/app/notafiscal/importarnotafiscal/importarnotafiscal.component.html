<div class="container">
  <div class="card">
    <div class="grid">
      <div class="col-12 md:col-6 lg:col-3">
        <h2>Cadastro Nota Fiscal</h2>
      </div>
    </div>

    <form #f="ngForm" autocomplete="off" (ngSubmit)="enviarNota(f)">
      <div class="p-fluid grid">
        <div class="col-12 md:col-6 lg:col-4 p-fluid">
          <span class="p-float-label">
            <input
              type="text"
              id="arquivo"
              required="true"
              name="arquivo_nota"
              pInputText
              readonly="true"
              [required]="true"
              #arquivo_nota="ngModel"
              [(ngModel)]="notaFiscal.arquivo_nota"
            />

            <label for="arquivo">Nome Arquivo</label>
          </span>
          <app-message
            [control]="arquivo_nota"
            error="required"
            text="Informe  a Forma de Pagamento"
          ></app-message>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <button
            pButton
            icon="pi pi-file-import"
            type="button"
            class="p-button-info p-button-lg"
            (click)="enviaXmlNota()"
            label="Selecionar xml Nota"
          ></button>
        </div>
        <div class="col-12 md:col-6 lg:col-4 p-fluid">
          <span class="p-float-label">
            <p-dropdown
              appendTo="body"
              [filter]="true"
              [autoDisplayFirst]="false"
              [showClear]="true"
              [required]="true"
              #id="ngModel"
              name="id"
              [options]="formasdepagamento"
              [(ngModel)]="formadePagmento.id"
            >
            </p-dropdown>
            <label for="dropdown">Forma de Pagamento</label>
          </span>
          <app-message
            [control]="id"
            error="required"
            text="Informe  a Forma de Pagamento"
          ></app-message>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <p-inputNumber
              mode="decimal"
              [(ngModel)]="auxiliar.percentual"
              [minFractionDigits]="3"
              [maxFractionDigits]="3"
              prefix="%"
              #percentual="ngModel"
              [required]="true"
              name="percentual"
            >
            </p-inputNumber>
            <label htmlFor="number-input">Percentual</label>
          </span>
          <app-message
            [control]="percentual"
            error="required"
            text="Informe  percentual de lucro"
          ></app-message>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <p-inputNumber
              inputId="integeronly"
              [(ngModel)]="auxiliar.quatidadeparcela"
              #quatidadeparcela="ngModel"
              [required]="true"
              name="quatidadeparcela"
            >
            </p-inputNumber>
            <label htmlFor="number-input">Quande de Parcela </label>
          </span>
          <app-message
            [control]="quatidadeparcela"
            error="required"
            text="Informe  quantidade de parcelas"
          ></app-message>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <button
            pButton
            icon="pi pi-send"
            class="p-button-success p-button-lg"
            type="submit"
            [disabled]="!f.valid"
            label="importar notal "
          ></button>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <button
            pButton
            pRipple
            type="button"
            icon="pi pi-sign-in"
            label="Voltar"
            routerLink="/importarnotalfiscal"
            class="p-button-outlined p-button-lg p-button-danger"
          ></button>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <button
            pButton
            pRipple
            type="button"
            icon="pi pi-plus"
            label="novo"
            (click)="novo()"
            class="p-button-outlined p-button-lg"
          ></button>
        </div>
        <div class="col-12 md:col-6 lg:col-4 p-fluid">
          <span class="p-float-label">
            <input
              type="text"
              id="arquivo"
              name="nome"
              pInputText
              readonly="true"
              [(ngModel)]="notaFiscal.fornecedor.nome"
              [readOnly]="true"
            />

            <label for="arquivo">Nome do Fornecedor</label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <input
              type="text"
              id="serie"
              name="serie"
              pInputText
              readonly="true"
              [(ngModel)]="notaFiscal.serie"
              [readOnly]="true"
            />

            <label for="serie">Serie</label>
          </span>
        </div>

        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <input
              type="text"
              id="modelo"
              name="modelo"
              pInputText
              readonly="true"
              [(ngModel)]="notaFiscal.modelo"
              [readOnly]="true"
            />

            <label for="modelo">Modelo</label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-4 p-fluid">
          <span class="p-float-label">
            <input
              type="text"
              id="chave"
              name="chaveNota"
              pInputText
              readonly="true"
              [(ngModel)]="notaFiscal.chaveNota"
              [readOnly]="true"
            />

            <label for="chave">Chave</label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <p-inputNumber
              mode="decimal"
              [(ngModel)]="notaFiscal.transporteNotafiscal.pesoBruto"
              [minFractionDigits]="3"
              [readonly]="true"
              [maxFractionDigits]="3"
              name="pesoBruto"
            >
            </p-inputNumber>
            <label htmlFor="number-input">Peso Bruto</label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <p-inputNumber
              inputId="integeronly"
              [(ngModel)]="notaFiscal.transporteNotafiscal.qtevolume"
              [readonly]="true"
              name="qtevolume">
            </p-inputNumber>
            <label htmlFor="number-input">Qtde de Volumes </label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-4 p-fluid">
          <span class="p-float-label">
            <input
              type="text"
              id="arquivo"
              name="nomeTransporte"
              pInputText
              [(ngModel)]="notaFiscal.transporteNotafiscal.nomeTransporte"
              [readOnly]="true"
            />

            <label for="arquivo">Nome da Transportadora</label>
          </span>
        </div>

        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <input
              type="text"
              id="arquivo"
              name="placaVeiculo"
              pInputText
              [(ngModel)]="notaFiscal.transporteNotafiscal.placaVeiculo"
              [readOnly]="true"
            />

            <label for="arquivo">Placa Veiculo</label>
          </span>
        </div>

        <div class="col-12 md:col-6 lg:col-4 p-fluid">
          <span class="p-float-label">
            <input
              type="text"
              id="arquivo"
              name="naturezaopercao"
              pInputText
              readonly="true"
              [(ngModel)]="notaFiscal.naturezaopercao"
              [readOnly]="true"
            />

            <label for="arquivo">Natureza da Operção</label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <p-inputNumber
              mode="decimal"
              [(ngModel)]="notaFiscal.transporteNotafiscal.pesoLiquido"
              [minFractionDigits]="3"
              [readonly]="true"
              [maxFractionDigits]="3"
              name="pesoLiquido"
            >
            </p-inputNumber>
            <label htmlFor="number-input">Peso Luíquido</label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <p-inputNumber
            currency="BRL" mode="currency"  locale="pt-Br"
              [(ngModel)]="notaFiscal.impostoNota.totalNota"
              [minFractionDigits]="2"
              [readonly]="true"
              [maxFractionDigits]="3"
              name="totalNota"
            >
            </p-inputNumber>
            <label htmlFor="number-input">Total da Nota</label>
          </span>
        </div>

        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <p-inputNumber
          currency="BRL" mode="currency"  locale="pt-Br"
              [(ngModel)]="notaFiscal.impostoNota.valorIcms"
              [minFractionDigits]="2"
              [readonly]="true"
              [maxFractionDigits]="3"
              name="valorIcms"
            >
            </p-inputNumber>
            <label htmlFor="number-input">Total Icms</label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <p-inputNumber
           currency="BRL" mode="currency"  locale="pt-Br"
              [(ngModel)]="notaFiscal.impostoNota.valorIpi"
              [minFractionDigits]="2"
              [readonly]="true"
              [maxFractionDigits]="3"
              name="valorIpi"
            >
            </p-inputNumber>
            <label htmlFor="number-input">Total Ipi</label>
          </span>
        </div>
        <div class="col-12 md:col-6 lg:col-2 p-fluid">
          <span class="p-float-label">
            <p-inputNumber
           currency="BRL" mode="currency"  locale="pt-Br"
              [(ngModel)]="notaFiscal.impostoNota.valorTributo"
              [minFractionDigits]="2"
              [readonly]="true"
              [maxFractionDigits]="3"
              name="valorTributo"
            >
            </p-inputNumber>
            <label htmlFor="number-input">Total Tributo</label>
          </span>
        </div>
        <div class="col-12">
          <p-table
            [value]="notaFiscal.items_entrada"
            responsiveLayout="stack"
            selectionMode="single"
            [rowHover]="true"
            #tabela
            dataKey="id"
            styleClass="p-datatable-gridlines p-datatable-sm p-datatable-customer"
          >
            <ng-template pTemplate="caption"> </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th>Itens da nota</th>
                <th>Código</th>
                <th>Nome Produto</th>
                <th style="text-align: right">Quantidade</th>
                <th style="text-align: right">Preço Venda</th>
                <th style="text-align: right"> Custo </th>
                <th style="text-align: right">Custo Medio</th>
                <th style="text-align: right">Subtotal</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item key let-rowIndex="rowIndex">
              <tr [pSelectableRow]="item">
                <td>{{ rowIndex + 1 }} / {{ totalDeItens }}</td>
                <td>{{ item.id }}</td>
                <td>{{ item.produto.nomeproduto }}</td>
                <td style="text-align: right">{{ item.qtde }}</td>
                <td style="text-align: right">
                  {{ item.produto.precovenda | currency }}
                </td>

                <td style="text-align: right">
                  {{
                    item.produto.precocusto | currency : "BRL" : true : "1.2-3"
                  }}
                </td>
                <td style="text-align: right">
                  {{
                    item.produto.customedio | currency : "BRL" : true : "1.2-3"
                  }}
                </td>
                <td style="text-align: right">
                  {{ item.subtotal | currency }}
                </td>
              </tr></ng-template
            >

            <ng-template pTemplate="summary">
              <div style="text-align: right">
                Total da Produto: {{ totalnota | currency }}
              </div>
            </ng-template>
          </p-table>
        </div>
      </div>
    </form>
  </div>
</div>
